<!DOCTYPE html>
<html lang="zh-CN">
<head>
<link rel="shortcut icon" type="image/x-icon" href="../img/favicon.ico" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>潜在客户记录器</title>
    <style>
        body {
            background-image: url('.././img/backgroundsy.png'); /* 替换为你的图片路径 */
            background-repeat: repeat; /* 图片重复铺满背景 */
            background-size: 241px 238px; /* 设置图片大小 */
            background-attachment: fixed; /* 使背景图片固定在窗口，不随内容滚动 */
            background-position: top left; /* 可选，设置背景图片的对齐方式 */
            background-color: #f4f4f9; /* 为避免图片加载时的闪烁效果，设置一个背景色 */
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #f8f8f8;
        }

        .container {
            max-width: 1000px; /* 增加容器的最大宽度 */
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        h1, h2 {
            color: #323271;
            text-align: center;
            margin-bottom: 20px;
        }

        form {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        label {
            font-weight: bold;
            flex: 1 0 100%;
        }

        input[type="text"],
        input[type="email"] {
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            flex: 1 1 calc(50% - 15px);
        }

        button {
            padding: 10px;
            background-color: #323271;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #1f1f5b;
        }

        .full-width {
            flex: 1 0 100%;
        }

        .btn-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .btn-container button {
            flex: 1;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            table-layout: fixed; /* 固定表格布局 */
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            vertical-align: middle;
        }

        th {
            background-color: #f2f2f2;
            color: #333;
        }

        .filter-select {
            width: 100%;
            box-sizing: border-box;
        }

        td .note-input {
            width: 100%;
            box-sizing: border-box;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            resize: none;
            min-height: 40px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
        }

        .delete-button {
            background-color: #ff4d4d;
            color: white;
            border: none;
            cursor: pointer;
            width: 100%;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .delete-button:hover {
            background-color: #cc0000;
        }

        .hidden {
            display: none;
        }

        /* Responsive design */
        @media (max-width: 600px) {
            form {
                flex-direction: column;
            }

            .btn-container {
                flex-direction: column;
                align-items: stretch;
            }

            .btn-container button {
                margin-bottom: 10px;
            }

            .filter-select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>潜在客户记录器</h1>
        <form id="customerForm">
            <label for="email">邮箱地址:</label>
            <input type="email" id="email" required>
            
            <label for="country">国家:</label>
            <input type="text" id="country" required>
            
            <label for="port">港口:</label>
            <input type="text" id="port" required>
            
            <button type="submit" class="full-width">添加</button>
        </form>
        <h2>潜在客户列表</h2>
        <div class="btn-container">
            <input type="file" id="importFile" class="hidden">
            <button id="importButton">导入记录</button>
            <button id="exportButton">导出记录</button>
        </div>
        <table id="customerTable">
            <thead>
                <tr>
                    <th>客户称呼</th>
                    <th>邮箱地址</th>
                    <th>
                    
                        <select id="filterCountry" class="filter-select">
                            <option value="">所有国家</option>
                        </select>
                    </th>
                    <th>
                    
                        <select id="filterPort" class="filter-select">
                            <option value="">所有港口</option>
                        </select>
                    </th>
                    <th>备注</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <!-- 潜在客户数据将显示在这里 -->
            </tbody>
        </table>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const filePath = 'customers';
            const customerForm = document.getElementById('customerForm');
            const customerTableBody = document.getElementById('customerTable').querySelector('tbody');
            const filterCountrySelect = document.getElementById('filterCountry');
            const filterPortSelect = document.getElementById('filterPort');
            const exportButton = document.getElementById('exportButton');
            const importButton = document.getElementById('importButton');
            const importFileInput = document.getElementById('importFile');

            let customers = [];

            function loadCustomers() {
                if (localStorage.getItem(filePath)) {
                    customers = JSON.parse(localStorage.getItem(filePath));
                } else {
                    localStorage.setItem(filePath, JSON.stringify([]));
                }
                displayCustomers();
                populateFilters();
            }

            function displayCustomers() {
                customerTableBody.innerHTML = '';
                const filteredCustomers = filterCustomers();
                filteredCustomers.forEach((customer, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td contenteditable="true" class="name">${customer.name || ''}</td>
                        <td contenteditable="true" class="email">${customer.email}</td>
                        <td contenteditable="true" class="country">${customer.country}</td>
                        <td contenteditable="true" class="port">${customer.port}</td>
                        <td><textarea class="note-input">${customer.note || ''}</textarea></td>
                        <td><button class="delete-button" data-index="${index}">删除</button></td>
                    `;
                    customerTableBody.appendChild(row);
                });

                document.querySelectorAll('.delete-button').forEach(button => {
                    button.addEventListener('click', deleteCustomer);
                });

                document.querySelectorAll('[contenteditable="true"]').forEach(cell => {
                    cell.addEventListener('blur', saveCustomer);
                });

                document.querySelectorAll('.note-input').forEach(input => {
                    input.addEventListener('blur', saveCustomer);
                });
            }

            function filterCustomers() {
                const filterCountry = filterCountrySelect.value.toLowerCase();
                const filterPort = filterPortSelect.value.toLowerCase();

                return customers.filter(customer => {
                    return (
                        (filterCountry === "" || customer.country.toLowerCase().includes(filterCountry)) &&
                        (filterPort === "" || customer.port.toLowerCase().includes(filterPort))
                    );
                }).sort((a, b) => {
                    if (a.country === b.country) {
                        return a.port.localeCompare(b.port);
                    }
                    return a.country.localeCompare(b.country);
                });
            }

            function populateFilters() {
                const countries = [...new Set(customers.map(customer => customer.country))].sort();
                const ports = [...new Set(customers.map(customer => customer.port))].sort();

                filterCountrySelect.innerHTML = '<option value="">所有国家</option>';
                filterPortSelect.innerHTML = '<option value="">所有港口</option>';

                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    filterCountrySelect.appendChild(option);
                });

                ports.forEach(port => {
                    const option = document.createElement('option');
                    option.value = port;
                    option.textContent = port;
                    filterPortSelect.appendChild(option);
                });
            }

            function deleteCustomer(e) {
                const index = e.target.getAttribute('data-index');
                customers.splice(index, 1);
                localStorage.setItem(filePath, JSON.stringify(customers));
                displayCustomers();
                populateFilters();
            }

            function saveCustomer(e) {
                const row = e.target.closest('tr');
                const index = Array.from(row.parentNode.children).indexOf(row);
                const name = row.querySelector('.name').textContent;
                const email = row.querySelector('.email').textContent;
                const country = row.querySelector('.country').textContent;
                const port = row.querySelector('.port').textContent;
                const note = row.querySelector('.note-input').value;

                customers[index] = { name, email, country, port, note };
                localStorage.setItem(filePath, JSON.stringify(customers));
                displayCustomers();
                populateFilters();
            }

            customerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const country = document.getElementById('country').value;
                const port = document.getElementById('port').value;

                customers.push({ name: '', email, country, port, note: '' });
                localStorage.setItem(filePath, JSON.stringify(customers));
                displayCustomers();
                populateFilters();
                customerForm.reset();
            });

            filterCountrySelect.addEventListener('change', displayCustomers);
            filterPortSelect.addEventListener('change', displayCustomers);

            exportButton.addEventListener('click', () => {
                const blob = new Blob([JSON.stringify(customers, null, 2)], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'customers.txt';
                a.click();
                URL.revokeObjectURL(url);
            });

            importButton.addEventListener('click', () => {
                importFileInput.click();
            });

            importFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        customers = JSON.parse(event.target.result);
                        localStorage.setItem(filePath, JSON.stringify(customers));
                        displayCustomers();
                        populateFilters();
                    };
                    reader.readAsText(file);
                }
            });

            loadCustomers();
        });

           function checkLocal() {
        if (window.location.protocol === 'file:') {
            document.body.innerHTML = '<div class="no-content">此页面不支持离线访问。</div>';
        }

    </script>
</body>
</html>
